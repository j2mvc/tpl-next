{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime-corejs2/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime-corejs2/helpers/esm/asyncToGenerator\";\nimport axios from 'axios';\nimport http from 'http';\nimport util from '../libs/util';\nimport config from './config.js'; // 创建一个 axios 实例\n\nvar service = axios.create({\n  // `baseURL` 将自动加在 `url` 前面，除非 `url` 是一个绝对 URL。\n  // 它可以通过设置一个 `baseURL` 便于为 axios 实例的方法传递相对 URL\n  baseURL: config.api,\n  // `timeout` 指定请求超时的毫秒数(0 表示无超时时间)\n  // 如果请求话费了超过 `timeout` 的时间，请求将被中断\n  timeout: 5000,\n  // `withCredentials` 表示跨域请求时是否需要使用凭证\n  // withCredentials: false, // 默认值为false\n  // `url` 是用于请求的服务器 URL\n  // `paramsSerializer` 是一个负责 `params` 序列化的函数\n  // (e.g. https://www.npmjs.com/package/qs, http://api.jquery.com/jquery.param/)\n  // paramsSerializer: function(params) {\n  //     return Qs.stringify(params, {arrayFormat: 'brackets'})\n  // },\n  // `adapter` 允许自定义处理请求，以使测试更轻松\n  // 返回一个 promise 并应用一个有效的响应 (查阅 [response docs](#response-api)).\n  // adapter: function (config) {\n  //     /* ... */\n  // },\n  // `responseType` 表示服务器响应的数据类型，可以是 'arraybuffer', 'blob', 'document', 'json', 'text', 'stream'\n  // responseType: 'json', // 默认的\n  // `xsrfCookieName` 是用作 xsrf token 的值的cookie的名称\n  // xsrfCookieName: 'XSRF-TOKEN', // default\n  // `xsrfHeaderName` 是承载 xsrf token 的值的 HTTP 头的名称\n  // xsrfHeaderName: 'X-XSRF-TOKEN', // 默认的\n  // `onUploadProgress` 允许为上传处理进度事件\n  // onUploadProgress: function (progressEvent) {\n  //     // 对原生进度事件的处理\n  // },\n  // `onDownloadProgress` 允许为下载处理进度事件\n  // onDownloadProgress: function (progressEvent) {\n  //     // 对原生进度事件的处理\n  // },\n  // `maxContentLength` 定义允许的响应内容的最大尺寸\n  // maxContentLength: 2000,\n  // `validateStatus` 定义对于给定的HTTP 响应状态码是 resolve 或 reject  promise 。如果 `validateStatus` 返回 `true` (或者设置为 `null` 或 `undefined`)，promise 将被 resolve; 否则，promise 将被 rejecte\n  // validateStatus: function (status) {\n  //     return status >= 200 && status < 300; // 默认的\n  // },\n  // headers: {\n  //     referer: 'https://ptjp.gov.cn/',\n  //     host: 'ptjp.gov.cn'\n  // },\n  // `maxRedirects` 定义在 node.js 中 follow 的最大重定向数目\n  // 如果设置为0，将不会 follow 任何重定向\n  // maxRedirects: 5, // 默认的\n  // `httpAgent` 和 `httpsAgent` 分别在 node.js 中用于定义在执行 http 和 https 时使用的自定义代理。允许像这样配置选项：\n  // `keepAlive` 默认没有启用\n  httpAgent: new http.Agent({\n    keepAlive: true\n  }),\n  // httpsAgent: new https.Agent({ keepAlive: true }),\n  // 'proxy' 定义代理服务器的主机名称和端口\n  // `auth` 表示 HTTP 基础验证应当用于连接代理，并提供凭据\n  // 这将会设置一个 `Proxy-Authorization` 头，覆写掉已有的通过使用 `header` 设置的自定义 `Proxy-Authorization` 头。\n  proxy: {\n    host: 'api.ptjp.gov.cn',\n    port: 80 // auth: {\n    //     username: 'mikeymike',\n    //     password: 'rapunz3l'\n    // },\n    // `cancelToken` 指定用于取消请求的 cancel token\n    // cancelToken: new CancelToken(function (cancel) {\n    // })\n\n  }\n});\n/**\n * 处理错误代码\n * @param error\n * @returns {{error: (*|{code: number, message: string})}}\n */\n\nvar handleError = function handleError(error) {\n  error = error || {\n    code: -1,\n    message: '请求失败'\n  }; // 对响应错误做点什么\n\n  if (error.response) {\n    switch (error.response.status) {\n      case 400:\n        error.message = '请求错误';\n        break;\n\n      case 401:\n        error.message = '未授权，请登录';\n        break;\n\n      case 403:\n        error.message = '拒绝访问';\n        break;\n\n      case 404:\n        error.message = \"\\u8BF7\\u6C42\\u5730\\u5740\\u51FA\\u9519: \".concat(error.response.config.url);\n        break;\n\n      case 408:\n        error.message = '请求超时';\n        break;\n\n      case 500:\n        error.message = '服务器内部错误';\n        break;\n\n      case 501:\n        error.message = '服务未实现';\n        break;\n\n      case 502:\n        error.message = '网关错误';\n        break;\n\n      case 503:\n        error.message = '服务不可用';\n        break;\n\n      case 504:\n        error.message = '网关超时';\n        break;\n\n      case 505:\n        error.message = 'HTTP版本不受支持';\n        break;\n\n      default:\n        break;\n    }\n  }\n\n  return {\n    error: error\n  };\n};\n/**\n * 拼接url的querystring\n * @param params\n * @returns {string}\n */\n\n\nvar parseParams = function parseParams(params) {\n  var str = '';\n\n  for (var k in params) {\n    var v = params[k];\n    str += (str != '' ? '&' : '?') + k + '=' + v;\n  }\n\n  return str;\n};\n/**\n * get数据\n * @param url\n * @param params\n * @param cache\n * @returns {Promise<*>}\n */\n\n\nvar get =\n/*#__PURE__*/\nfunction () {\n  var _ref = _asyncToGenerator(\n  /*#__PURE__*/\n  _regeneratorRuntime.mark(function _callee(props) {\n    var url, params, cache;\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            url = props.url, params = props.params, cache = props.cache; // 这会在应用中暴露\n\n            params.apikey = config.apiKey;\n            return _context.abrupt(\"return\", service({\n              method: 'get',\n              url: config.api + url,\n              params: params,\n              mode: 'no-cors'\n            }).then(function (res) {\n              console.log('data:', res.data);\n\n              if (res.error) {\n                return {\n                  error: res.error\n                };\n              }\n\n              var json = res.data; // 获取到数据\n\n              if (json.code == 1) {\n                return json;\n              } // 处理服务器返回的错误\n\n\n              if (json.error) {\n                return handleError(json.error);\n              } else {\n                var message = json.message ? json.message : '请求失败';\n                return handleError({\n                  code: -1,\n                  message: message\n                });\n              }\n            }).catch(function (error) {\n              return handleError(error);\n            }));\n\n          case 3:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee);\n  }));\n\n  return function get(_x) {\n    return _ref.apply(this, arguments);\n  };\n}();\n/**\n * 提交数据\n * @param url\n * @param data\n * @param cache\n * @returns {*}\n */\n\n\nvar post = function post(_ref2) {\n  var url = _ref2.url,\n      data = _ref2.data,\n      cache = _ref2.cache;\n};\n\nexport default {\n  get: get,\n  post: post\n};","map":{"version":3,"sources":["/Users/wanjia/Documents/works/gitrepos/tpl/tpl-next/api/request.js"],"names":["axios","http","util","config","service","create","baseURL","api","timeout","httpAgent","Agent","keepAlive","proxy","host","port","handleError","error","code","message","response","status","url","parseParams","params","str","k","v","get","props","cache","apikey","apiKey","method","mode","then","res","console","log","data","json","catch","post"],"mappings":"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","sourcesContent":["import axios from 'axios'\nimport http from 'http'\nimport util from '../libs/util'\nimport config from './config.js'\n\n// 创建一个 axios 实例\nconst service = axios.create({\n    // `baseURL` 将自动加在 `url` 前面，除非 `url` 是一个绝对 URL。\n    // 它可以通过设置一个 `baseURL` 便于为 axios 实例的方法传递相对 URL\n    baseURL: config.api,\n    // `timeout` 指定请求超时的毫秒数(0 表示无超时时间)\n    // 如果请求话费了超过 `timeout` 的时间，请求将被中断\n    timeout: 5000,\n    // `withCredentials` 表示跨域请求时是否需要使用凭证\n    // withCredentials: false, // 默认值为false\n    // `url` 是用于请求的服务器 URL\n\n    // `paramsSerializer` 是一个负责 `params` 序列化的函数\n    // (e.g. https://www.npmjs.com/package/qs, http://api.jquery.com/jquery.param/)\n    // paramsSerializer: function(params) {\n    //     return Qs.stringify(params, {arrayFormat: 'brackets'})\n    // },\n\n\n    // `adapter` 允许自定义处理请求，以使测试更轻松\n    // 返回一个 promise 并应用一个有效的响应 (查阅 [response docs](#response-api)).\n    // adapter: function (config) {\n    //     /* ... */\n    // },\n\n    // `responseType` 表示服务器响应的数据类型，可以是 'arraybuffer', 'blob', 'document', 'json', 'text', 'stream'\n    // responseType: 'json', // 默认的\n    // `xsrfCookieName` 是用作 xsrf token 的值的cookie的名称\n    // xsrfCookieName: 'XSRF-TOKEN', // default\n    // `xsrfHeaderName` 是承载 xsrf token 的值的 HTTP 头的名称\n    // xsrfHeaderName: 'X-XSRF-TOKEN', // 默认的\n    // `onUploadProgress` 允许为上传处理进度事件\n    // onUploadProgress: function (progressEvent) {\n    //     // 对原生进度事件的处理\n    // },\n\n    // `onDownloadProgress` 允许为下载处理进度事件\n    // onDownloadProgress: function (progressEvent) {\n    //     // 对原生进度事件的处理\n    // },\n\n    // `maxContentLength` 定义允许的响应内容的最大尺寸\n    // maxContentLength: 2000,\n\n    // `validateStatus` 定义对于给定的HTTP 响应状态码是 resolve 或 reject  promise 。如果 `validateStatus` 返回 `true` (或者设置为 `null` 或 `undefined`)，promise 将被 resolve; 否则，promise 将被 rejecte\n    // validateStatus: function (status) {\n    //     return status >= 200 && status < 300; // 默认的\n    // },\n    // headers: {\n    //     referer: 'https://ptjp.gov.cn/',\n    //     host: 'ptjp.gov.cn'\n    // },\n\n    // `maxRedirects` 定义在 node.js 中 follow 的最大重定向数目\n    // 如果设置为0，将不会 follow 任何重定向\n    // maxRedirects: 5, // 默认的\n\n    // `httpAgent` 和 `httpsAgent` 分别在 node.js 中用于定义在执行 http 和 https 时使用的自定义代理。允许像这样配置选项：\n    // `keepAlive` 默认没有启用\n     httpAgent: new http.Agent({ keepAlive: true }),\n    // httpsAgent: new https.Agent({ keepAlive: true }),\n\n    // 'proxy' 定义代理服务器的主机名称和端口\n    // `auth` 表示 HTTP 基础验证应当用于连接代理，并提供凭据\n    // 这将会设置一个 `Proxy-Authorization` 头，覆写掉已有的通过使用 `header` 设置的自定义 `Proxy-Authorization` 头。\n    proxy: {\n        host: 'api.ptjp.gov.cn',\n        port: 80,\n    // auth: {\n    //     username: 'mikeymike',\n    //     password: 'rapunz3l'\n    }\n    // },\n    // `cancelToken` 指定用于取消请求的 cancel token\n    // cancelToken: new CancelToken(function (cancel) {\n    // })\n})\n\n/**\n * 处理错误代码\n * @param error\n * @returns {{error: (*|{code: number, message: string})}}\n */\nconst handleError = error =>{\n    error = error || {code:-1,message : '请求失败'};\n    // 对响应错误做点什么\n    if (error.response) {\n        switch (error.response.status) {\n            case 400:\n                error.message = '请求错误';\n                break\n            case 401:\n                error.message = '未授权，请登录';\n                break\n            case 403:\n                error.message = '拒绝访问';\n                break\n            case 404:\n                error.message = `请求地址出错: ${error.response.config.url}`;\n                break\n            case 408:\n                error.message = '请求超时';\n                break\n            case 500:\n                error.message = '服务器内部错误';\n                break\n            case 501:\n                error.message = '服务未实现';\n                break\n            case 502:\n                error.message = '网关错误';\n                break\n            case 503:\n                error.message = '服务不可用';\n                break\n            case 504:\n                error.message = '网关超时';\n                break\n            case 505:\n                error.message = 'HTTP版本不受支持';\n                break\n            default:\n                break\n        }\n    }\n    return {\n        error\n    };\n}\n/**\n * 拼接url的querystring\n * @param params\n * @returns {string}\n */\nconst parseParams = params =>{\n    let str = '';\n    for (let k in params){\n        let v = params[k];\n        str += (str != '' ? '&':'?') + k+'='+v;\n    }\n    return str;\n}\n/**\n * get数据\n * @param url\n * @param params\n * @param cache\n * @returns {Promise<*>}\n */\nconst get = async props =>{\n    const {url,params,cache} = props\n    // 这会在应用中暴露\n    params.apikey = config.apiKey;\n\n    return service({\n        method: 'get',\n        url:config.api + url,\n        params,\n        mode: 'no-cors'\n    }).then(res => {\n        console.log('data:',res.data)\n        if(res.error){\n            return {error:res.error};\n        }\n        const json = res.data;\n        // 获取到数据\n        if(json.code == 1){\n            return json;\n        }\n        // 处理服务器返回的错误\n        if(json.error){\n            return handleError(json.error);\n        }else{\n            const message = json.message?json.message:'请求失败';\n            return handleError({code:-1,message:message})\n        }\n    }).catch(error =>{\n        return handleError(error);\n    })\n}\n/**\n * 提交数据\n * @param url\n * @param data\n * @param cache\n * @returns {*}\n */\nconst post = ({url, data,cache}) =>{\n\n}\nexport default {\n    get,post\n}\n\n"]},"metadata":{},"sourceType":"module"}